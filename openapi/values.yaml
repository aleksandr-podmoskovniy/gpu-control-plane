# Copyright 2025 Flant JSC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

x-extend:
  schema: config-values.yaml
type: object
properties:
  internal:
    type: object
    description: Computed values populated by GPU Control Plane hooks (certificates, rendered manifests, runtime state).
    default: {}
    properties:
      rootCA:
        type: object
        description: Root certificate authority used to sign all module-issued TLS credentials.
        default: {}
        properties:
          ca:
            type: string
            description: PEM-encoded bundle of the root CA certificate chain.
          crt:
            type: string
            description: PEM-encoded root CA certificate.
          key:
            type: string
            description: PEM-encoded private key of the root CA.
        additionalProperties: false
      controller:
        type: object
        description: Controller-specific computed values.
        default: {}
        properties:
          config:
            type: object
            description: Rendered controller-runtime configuration (mounted into the controller Pod).
            default: {}
            additionalProperties: true
          cert:
            type: object
            description: TLS certificate chain and key used by the controller admission webhook.
            default: {}
            properties:
              ca:
                type: string
                description: PEM-encoded issuing CA bundle for the webhook certificate.
              crt:
                type: string
                description: PEM-encoded certificate presented by the controller webhook server.
              key:
                type: string
                description: PEM-encoded private key of the controller webhook certificate.
            additionalProperties: false
        additionalProperties: false
      customCertificateData:
        type: object
        description: TLS bundle provided by the operator to replace internally generated certificates.
        default: {}
        properties:
          tls.crt:
            type: string
            description: PEM-encoded certificate supplied by the operator.
          tls.key:
            type: string
            description: PEM-encoded private key that matches `tls.crt`.
          ca.crt:
            type: string
            description: PEM-encoded CA bundle associated with the custom certificate.
        additionalProperties: false
      moduleConfig:
        type: object
        description: Sanitised ModuleConfig settings consumed by templates/runtime components.
        default: {}
        additionalProperties: true
      moduleConfigValidation:
        type: object
        description: Validation status of ModuleConfig produced by hooks.
        properties:
          error:
            type: string
            description: Human readable validation error.
        additionalProperties: true
      conditions:
        type: array
        description: Module status conditions reported to Deckhouse.
        items:
          type: object
          additionalProperties: true
      webhook:
        type: object
        description: Admission webhook internal data.
        default: {}
        additionalProperties: true
      nodeFeatureRule:
        type: object
        description: Bootstrap data for NodeFeatureRule rendering.
        default: {}
        additionalProperties: true
    additionalProperties: true
additionalProperties: false
