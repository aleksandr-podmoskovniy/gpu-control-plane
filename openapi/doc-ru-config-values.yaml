type: object
description: |
  Пользовательская конфигурация модуля GPU Control Plane. Параметры ниже охватывают основные сценарии управления GPU, а остальные настройки берутся из значений по умолчанию.
properties:
  highAvailability:
    description: |
      Управляет высокой доступностью контроллера и вебхуков.

      * `true` — всегда запускать по две реплики каждого компонента вне зависимости от топологии control plane.
      * `false` — закрепить работу в однорепликовом режиме.
      * значение не задано — позволить платформе автоматически определить, нужен ли HA.
  managedNodes:
    description: |
      Определяет, какой меткой помечаются управляемые узлы и считается ли обслуживание включённым по умолчанию.
    properties:
      labelKey:
        description: |
          Ключ метки на узлах. Пока значение метки не равно строке `false`, узел считается управляемым. Значение по умолчанию — `gpu.deckhouse.io/enabled`.
      enabledByDefault:
        description: |
          Если `true`, узлы управляются до тех пор, пока администратор не установит `labelKey=false`. Значение по умолчанию — `true`.
  deviceApproval:
    description: |
      Политика подтверждения новых GPU-устройств: ручное решение, автоматическое включение или селектор на основе метаданных.
    properties:
      mode:
        description: |
          Режим подтверждения:
            * `Manual` — устройства остаются в ожидании, требуется действие администратора;
            * `Automatic` — устройства подтверждаются сразу после обнаружения;
            * `Selector` — автоматическое подтверждение только для устройств, подходящих под селектор.
      selector:
        description: |
          Kubernetes LabelSelector, применяемый в режиме `Selector`. Устройство должно удовлетворять селектору, чтобы быть подтверждённым автоматически.
        properties:
          matchLabels:
            description: |
              Список обязательных пар `ключ=значение`.
          matchExpressions:
            description: |
              Выражения селектора (`In`, `NotIn`, `Exists`, `DoesNotExist`), проверяющие метаданные устройства.
            items:
              description: |
                Отдельное выражение селектора: ключ, оператор и набор значений (для `In`/`NotIn`).
  scheduling:
    description: |
      Значения по умолчанию для планирования GPU-нагрузки. Наследуются новыми пулами и workload’ами, если они не задали собственные параметры.
    properties:
      defaultStrategy:
        description: |
          Стратегия размещения: `Spread` распределяет workload по зонам, `BinPack` уплотняет нагрузку на минимальном числе узлов. Значение по умолчанию — `Spread`.
      topologyKey:
        description: |
          Ключ топологии Kubernetes, используемый при стратегии `Spread`. Значение по умолчанию — `topology.kubernetes.io/zone`.
  inventory:
    description: |
      Настройки периодического опроса о состоянии узлов inventory-контроллером.
    properties:
      resyncPeriod:
        description: |
          Интервал принудительной синхронизации при отсутствии событий. Формат — `30s`, `1m`, `5m` и т. п. (Go duration). Значение по умолчанию — `30s`.
  https:
    description: |
      Конфигурация HTTPS для вебхуков и вспомогательных конечных точек. Можно выбирать между самоподписанными сертификатами, готовым Secret и автоматическим выпуском через cert-manager.
    properties:
      mode:
        description: |
          Режим работы:
            * `CertManager` — сертификат выпускается ClusterIssuer, указанным в `certManager.clusterIssuerName`;
            * `CustomCertificate` — используется Secret в `d8-system`, заданный в `customCertificate.secretName`;
            * `OnlyInURI` — сервис остаётся на HTTP, но публикует HTTPS-ссылки (для внешней TLS-терминации);
            * `Disabled` — работа только по HTTP.
          Значение по умолчанию — `CertManager`.
      certManager:
        description: |
          Настройки cert-manager. Используются только в режиме `CertManager`.
        properties:
          clusterIssuerName:
            description: |
              Имя ClusterIssuer, через который нужно получить сертификат. Значение по умолчанию — `letsencrypt`.
      customCertificate:
        description: |
          Параметры пользовательского сертификата, применяемые в режиме `CustomCertificate`.
        properties:
          secretName:
            description: |
          Имя Secret в пространстве имён `d8-system`, содержащего ключи `tls.crt`, `tls.key` и `ca.crt`.
