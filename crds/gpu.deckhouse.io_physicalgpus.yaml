---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  labels:
    module: gpu-control-plane
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: physicalgpus.gpu.deckhouse.io
spec:
  group: gpu.deckhouse.io
  names:
    categories:
    - deckhouse
    - gpu
    kind: PhysicalGPU
    listKind: PhysicalGPUList
    plural: physicalgpus
    shortNames:
    - pgpu
    singular: physicalgpu
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.nodeInfo.nodeName
      name: Node
      type: string
    - jsonPath: .status.pciInfo.vendor.name
      name: Vendor
      type: string
    - jsonPath: .status.pciInfo.device.name
      name: Device
      type: string
    - jsonPath: .status.conditions[?(@.type=="DriverReady")].status
      name: DriverReady
      type: string
    - jsonPath: .status.conditions[?(@.type=="HardwareHealthy")].status
      name: HardwareHealthy
      type: string
    - jsonPath: .status.currentState.vendor.nvidia.driverVersion
      name: DriverVersion
      priority: 1
      type: string
    - jsonPath: .status.currentState.vendor.nvidia.cudaVersion
      name: CUDAVersion
      priority: 1
      type: string
    - jsonPath: .status.capabilities.vendor.nvidia.computeCap
      name: ComputeCap
      priority: 1
      type: string
    - jsonPath: .status.capabilities.vendor.nvidia.migSupported
      name: MIGSupported
      priority: 1
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: PhysicalGPU is the Schema for the physicalgpus API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              PhysicalGPUSpec defines the desired state of PhysicalGPU.
              v0: desired state is intentionally empty.
            type: object
          status:
            description: PhysicalGPUStatus defines the observed state of PhysicalGPU.
            properties:
              capabilities:
                description: Capabilities is a snapshot of device capabilities.
                properties:
                  memoryMiB:
                    description: MemoryMiB is the total framebuffer memory in MiB.
                    format: int64
                    type: integer
                  productName:
                    description: ProductName is the GPU product name (for example
                      "NVIDIA A30").
                    type: string
                  vendor:
                    description: Vendor holds vendor-specific capabilities.
                    properties:
                      nvidia:
                        description: Nvidia holds NVIDIA-specific capabilities.
                        properties:
                          boardPartNumber:
                            description: BoardPartNumber is the NVIDIA board part
                              number.
                            type: string
                          computeCap:
                            description: ComputeCap is the CUDA compute capability
                              string (for example "8.0").
                            type: string
                          computeTypes:
                            description: ComputeTypes lists supported compute types.
                            items:
                              type: string
                            type: array
                            x-kubernetes-list-type: atomic
                          mig:
                            description: MIG contains MIG capabilities (only when
                              MIGSupported is true).
                            properties:
                              profiles:
                                description: Profiles lists supported MIG profiles.
                                items:
                                  description: NvidiaMIGProfile describes a supported
                                    MIG profile.
                                  properties:
                                    maxInstances:
                                      description: MaxInstances is the maximum number
                                        of instances for this profile.
                                      format: int32
                                      type: integer
                                    memoryMiB:
                                      description: MemoryMiB is the framebuffer size
                                        for the profile.
                                      format: int32
                                      type: integer
                                    name:
                                      description: Name is the profile name, for example
                                        "2g.12gb".
                                      type: string
                                    profileID:
                                      description: ProfileID is the numeric profile
                                        ID.
                                      format: int32
                                      type: integer
                                    sliceCount:
                                      description: SliceCount is the number of slices
                                        consumed by the profile.
                                      format: int32
                                      type: integer
                                  type: object
                                type: array
                                x-kubernetes-list-type: atomic
                              totalSlices:
                                description: TotalSlices is the total number of MIG
                                  slices on the GPU.
                                format: int32
                                type: integer
                            type: object
                          migSupported:
                            description: MIGSupported indicates whether MIG is supported.
                            type: boolean
                          productArchitecture:
                            description: ProductArchitecture is the NVIDIA architecture
                              name (for example "Ampere").
                            type: string
                        type: object
                    type: object
                type: object
              conditions:
                description: Conditions represent the health and readiness of the
                  GPU.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-type: atomic
              currentState:
                description: CurrentState reflects current driver binding and mode
                  details.
                properties:
                  driverType:
                    description: DriverType is the current driver binding (Nvidia/VFIO/ROCm).
                    enum:
                    - Nvidia
                    - VFIO
                    - ROCm
                    type: string
                  nvidia:
                    description: Nvidia holds NVIDIA-specific current state (when
                      driverType=Nvidia).
                    properties:
                      cudaVersion:
                        description: CUDAVersion is the reported CUDA version string.
                        type: string
                      driverVersion:
                        description: DriverVersion is the NVIDIA driver version string.
                        type: string
                      gpuUUID:
                        description: GPUUUID is the NVIDIA GPU UUID.
                        type: string
                      mig:
                        description: MIG describes the current MIG mode (when supported).
                        properties:
                          mode:
                            description: Mode is the current MIG mode.
                            enum:
                            - Enabled
                            - Disabled
                            - NotAvailable
                            - Unknown
                            type: string
                        type: object
                    type: object
                type: object
              nodeInfo:
                description: NodeInfo contains node identification and OS/kernel details.
                properties:
                  bareMetal:
                    description: BareMetal indicates whether the node is detected
                      as bare metal.
                    type: boolean
                  kernelRelease:
                    description: KernelRelease is the kernel release string (uname
                      -r).
                    type: string
                  nodeName:
                    description: NodeName is the Kubernetes node name where the GPU
                      is detected.
                    type: string
                  os:
                    description: OS describes the operating system identification.
                    properties:
                      id:
                        description: ID is the OS identifier (for example "ubuntu").
                        type: string
                      name:
                        description: Name is the human-readable OS name.
                        type: string
                      version:
                        description: Version is the OS version identifier (for example
                          "22.04").
                        type: string
                    type: object
                type: object
              pciInfo:
                description: PCIInfo holds PCI identification details for the device.
                properties:
                  address:
                    description: Address is the PCI address, for example "0000:02:00.0".
                    type: string
                  class:
                    description: Class describes the PCI class.
                    properties:
                      code:
                        description: Code is the PCI class code (base+subclass), for
                          example "0302".
                        type: string
                      name:
                        description: Name is the class name (for example "3D controller").
                        type: string
                    type: object
                  device:
                    description: Device describes the PCI device.
                    properties:
                      id:
                        description: ID is the PCI device ID, for example "20b7".
                        type: string
                      name:
                        description: Name is the device name (for example "GA100GL
                          [A30 PCIe]").
                        type: string
                    type: object
                  vendor:
                    description: Vendor describes the PCI vendor.
                    properties:
                      id:
                        description: ID is the PCI vendor ID, for example "10de".
                        type: string
                      name:
                        description: Name is the vendor name (for example "NVIDIA
                          Corporation").
                        type: string
                    type: object
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
