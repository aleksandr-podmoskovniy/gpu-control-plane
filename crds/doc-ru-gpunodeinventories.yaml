spec:
  versions:
    - name: v1alpha1
      schema:
        openAPIV3Schema:
          description: >
            Ресурс, агрегирующий всю GPU-информацию по узлу Kubernetes: обнаруженные
            устройства, версию драйвера, готовность мониторинга и участие в пулах.
          properties:
            spec:
              description: Настройка связывает инвентарь с конкретным узлом.
              properties:
                nodeName:
                  description: Имя узла Kubernetes, для которого ведётся инвентаризация.
            status:
              description: Текущие сведения об оборудовании узла, драйвере и пулах.
              properties:
                hw:
                  description: Список GPU устройств, обнаруженных на узле.
                  properties:
                    present:
                      description: Есть ли поддерживаемые карты на узле.
                    devices:
                      description: Детальные данные по каждой карте.
                      items:
                        properties:
                          inventoryID:
                            description: Стабильный идентификатор карты (совпадает с GPUDevice.status.inventoryID).
                          product:
                            description: Название модели GPU.
                          pci:
                            description: PCI-идентификаторы устройства.
                          memoryMiB:
                            description: Объём видеопамяти в MiB.
                          mig:
                            description: Возможности и конфигурация MIG.
                          uuid:
                            description: UUID устройства по данным NVML/DCGM.
                          computeCapability:
                            description: Версия CUDA Compute Capability.
                          precision:
                            description: Поддерживаемые типы точности вычислений.
                          state:
                            description: Текущее состояние карты (`Discovered`, `Validating`, `Ready`, `PendingAssignment`, `Assigned`, `Reserved`, `InUse`, `Faulted`).
                          autoAttach:
                            description: Включена ли автоматическая привязка карты к пулам.
                          reason:
                            description: Причина ожидания/непривязки устройства.
                          health:
                            description: Телеметрия DCGM для карты.
                            properties:
                              temperatureC:
                                description: Температура GPU в градусах Цельсия.
                              eccErrorsTotal:
                                description: Суммарное количество ошибок ECC.
                              lastUpdated:
                                description: Время последнего обновления телеметрии.
                              lastHealthyTime:
                                description: Время последнего успешного heartbeat без ошибок.
                              consecutiveHealthy:
                                description: Сколько подряд heartbeat'ов прошли без ошибок.
                              lastError:
                                description: Текст последней зарегистрированной ошибки.
                              lastErrorReason:
                                description: Категория последней ошибки (XID, ECC и т.п.).
                              lastErrorTime:
                                description: Когда ошибка была обнаружена.
                              metrics:
                                description: Дополнительные показатели от драйвера/детектора.
                driver:
                  description: Версии драйвера и CUDA toolkits, установленные на узле.
                  properties:
                    version:
                      description: Версия драйвера NVIDIA.
                    cudaVersion:
                      description: Версия CUDA Runtime.
                    toolkitInstalled:
                      description: Пройдена ли подготовка CUDA toolkit на узле.
                monitoring:
                  description: Состояние сервисов мониторинга (GFD/DCGM).
                  properties:
                    dcgmReady:
                      description: Запущен и отвечает ли DCGM Exporter.
                    lastHeartbeat:
                      description: Время последнего успешного heartbeat от мониторинга.
                    consecutiveHeartbeats:
                      description: Количество подряд полученных heartbeat'ов от DCGM Exporter.
                    consecutiveFailures:
                      description: Количество подряд неудачных проверок мониторинга.
                bootstrap:
                  description: Результаты проверки узла bootstrap-контроллером.
                  properties:
                    phase:
                      description: Текущая фаза bootstrap (`Disabled`, `Validating`, `GFD`, `Monitoring`, `Ready`).
                    gfdReady:
                      description: Установка GPU Feature Discovery завершена успешно.
                    toolkitReady:
                      description: Установка необходимых CUDA-компонентов завершена успешно.
                    lastRun:
                      description: Последнее время запуска bootstrap-процедуры.
                    workloads:
                      description: Список bootstrap-ворклоадов с их состоянием (validator, GFD, DCGM, dcgm-exporter).
                      items:
                        type: object
                        properties:
                          name:
                            description: Имя компонента (`validator`, `gpu-feature-discovery`, `dcgm`, `dcgm-exporter`).
                            type: string
                          healthy:
                            description: Признак того, что ворклоад работает и готов.
                            type: boolean
                          message:
                            description: Диагностическое сообщение, если `healthy=false`.
                            type: string
                          since:
                            description: Время, когда ворклоад перешёл в текущее состояние.
                            format: date-time
                            type: string
                      type: array
                pools:
                  description: Участие узла и его устройств в пулах.
                  properties:
                    assigned:
                      description: Пулы, которые уже используют ресурсы узла.
                    pending:
                      description: Пулы, ожидающие подтверждения или автоматического назначения.
                conditions:
                  description: Список агрегированных условий готовности узла.
                devices:
                  description: Сводка состояний устройств на узле (готовы, ожидают,
                    закреплены за пулом, зарезервированы, используются, на валидации,
                    неисправны или проигнорированы).
                  properties:
                    total:
                      description: Общее количество GPU-устройств на узле.
                    ready:
                      description: Карты, прошедшие инфраструктурную подготовку и готовые к выдаче.
                    pendingAssignment:
                      description: Карты, ожидающие подтверждения/назначения пулом.
                    assigned:
                      description: Карты, закреплённые за пулом и готовые к использованию.
                    reserved:
                      description: Карты во временном резерве (под запуск пода).
                    inUse:
                      description: Карты, которые используются текущими подами.
                    validating:
                      description: Карты, находящиеся в процессе валидации.
                    faulted:
                      description: Карты, переведённые в Faulted из-за проблем с железом или инфраструктурой.
                    ignored:
                      description: Карты, временно исключённые оператором (`gpu.deckhouse.io/ignore=true`).
